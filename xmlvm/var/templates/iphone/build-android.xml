<?xml version="1.0" encoding="UTF-8"?>
<project name="Android-impl" basedir="..">

	<!-- Project properties have been already loaded by the xmlvm.xml script -->

	<!-- netbeans variable is netbeans.home -->

	<!-- Define Android targets -->
	<path id="android.antlibs">
		<pathelement path="${sdk.dir}/tools/lib/anttasks.jar" />
		<pathelement path="${sdk.dir}/tools/lib/sdklib.jar" />
		<pathelement path="${sdk.dir}/tools/lib/androidprefs.jar" />
	</path>
	<taskdef name="setup" classname="com.android.ant.SetupTask" classpathref="android.antlibs" /> 
	<setup />

	<!-- Convert iPhone project to Android -->
	<taskdef name="aupdate" classname="com.panayotis.mobile.ant.SynchronizeProject" classpath="${update.project.jar}" onerror="fail"/>
	<fail unless="main.class" message="Please define property main.class before executing Android targets"/>
	<aupdate mainclass="${main.class}" generated="${gen.dir}" displayname="${bundle.displayname}" resources="${resource.dir}" asset="${asset.dir}" iosresources="${xmlvm.resource}" ignore="${ignore.android.update}"/>

	<!-- 
		Android targets
	 -->

	<target name="-target-compile" depends="compile"/>
	<target name="-target-debug" depends="debug,install,-debug-start-debuggee,-debug-start-debugger" if="netbeans.home"/>
	<target name="-target-jar" depends="release"/>
	<target name="-target-clean" depends="clean"/>

	<target name="-target-run" depends="release,install">
		<taskdef name="amanifest" classname="org.xmlvm.ant.AndroidManifestParser" classpath="${xmlvm.sdk.jar}"/>
		<amanifest manifest="AndroidManifest.xml"/>
		<exec executable="${sdk.dir}/platform-tools/adb" failonerror="true">
			<arg value="logcat"/>
			<arg value="-c"/>
		</exec>
		<exec executable="${sdk.dir}/platform-tools/adb" failonerror="true">
			<arg value="shell"/>
			<arg value="am start -n ${xmlvm.android.package}/${xmlvm.android.activity}"/>
		</exec>
		<exec executable="${sdk.dir}/platform-tools/adb" failonerror="true">
			<arg value="logcat"/>
			<arg value="-s"/>
			<arg value="AndroidRuntime:E"/>
			<arg value="System.out:I"/>
			<arg value="System.err:W"/>
			<arg value="NSLog:*"/>
		</exec>
	</target>

	<target name="-debug-start-debuggee" depends="install">
		<taskdef name="amanifest" classname="org.xmlvm.ant.AndroidManifestParser" classpath="${xmlvm.sdk.jar}"/>
		<amanifest manifest="AndroidManifest.xml"/>
		<exec executable="${sdk.dir}/platform-tools/adb" failonerror="true">
			<arg value="logcat"/>
			<arg value="-c"/>
		</exec>
		<exec executable="${sdk.dir}/platform-tools/adb" failonerror="true">
			<arg value="shell"/>
			<arg value="am start -D -n ${xmlvm.android.package}/${xmlvm.android.activity}"/>
		</exec>
	</target>

	<target name="-debug-start-debugger" if="netbeans.home">
	<!--	
		<taskdef name="agetdebugport" classname="com.panayotis.mobile.ant.GetDebuggerPort" classpath="${update.project.jar}:${user.home}/.mobiledev/android/sdk/tools/lib/ddmlib.jar" onerror="fail"/>
		<agetdebugport addressProperty="android.debug.port" app="${xmlvm.android.package}"/>
	 -->
		<nbjpdaconnect name="${bundle.displayname}" address="8700" transport="dt_socket">
			<classpath>
				<path path="${debug.classpath}"/>
			</classpath>
		</nbjpdaconnect>
		<exec executable="${sdk.dir}/platform-tools/adb" failonerror="true">
			<arg value="logcat"/>
			<arg value="-s"/>
			<arg value="AndroidRuntime:E"/>
			<arg value="System.out:I"/>
			<arg value="System.err:W"/>
			<arg value="NSLog:*"/>
		</exec>
	</target>

</project>
