check_file () {
	if [ ! -f "$1" ] ; then
		echo "File $1 does not exist."
		exit 1
	fi
}

sync_file () {
	check_file "$1"
	check_file "$2"
	CHECK=`diff $1 $2`
	if [ -n "$CHECK" ] ; then
		diff "$1" "$2"
		echo -n "Press [RETURN] to update file $2 from template, or [CTR]-C to cancel: "
		read QQ
		cp "$1" "$2"
		echo
	fi
}

sync_build_file () {
	check_file "$1"
	check_file "$2"
	CHECK=`diff $1 $2 | grep '^[<>]' | grep -v '<project name=' | grep -v '<description>' | grep -v 'local.properties' | grep -v 'demoproject.properties'`
	if [ -n "$CHECK" ] ; then
		xxdiff $1 $2
	fi
}

sync_proj_prop () {
	check_file "$1"
	check_file "$2"
	CHECK=`diff $1 $2 | grep '^[<>]' | grep -v xmlvm.sdk.jar | grep -v application.title`
	if [ -n "$CHECK" ] ; then
		xxdiff $1 $2
	fi
}

sync_build_impl () {
	check_file "$1"
	check_file "$2"
	CHECK=`diff $1 $2 | grep '^[<>]' | grep -v 'project xmlns:' | grep -v 'Cycle detected'`
	if [ -n "$CHECK" ] ; then
		xxdiff $1 $2
	fi
}


ILOC=var/templates/iphone
ALOC=var/templates/android

# Check template files
#sync_file $ILOC/build-java.xml $ALOC/build-java.xml
#sync_file $ILOC/build-xcode.xml $ALOC/build-xcode.xml
#sync_file $ILOC/build-impl.xml $ALOC/build-impl.xml
#sync_file $ILOC/xmlvm.xml $ALOC/xmlvm.xml


# Check iphone target
for i in $IPHONE_PROJECTS ; do
	sync_file $ILOC/build-java.xml demo/iphone/$i/nbproject/build-java.xml
	sync_file $ILOC/build-xcode.xml demo/iphone/$i/nbproject/build-xcode.xml
	sync_file $ILOC/xmlvm.xml demo/iphone/$i/nbproject/xmlvm.xml
	rm -f $ILOC/nbproject/xcode.xml 

	sync_build_file demo/iphone/ifireworks/build.xml demo/iphone/$i/build.xml
done
for i in $ANDROID_PROJECTS ; do
	sync_file $ALOC/build-java.xml demo/android/$i/nbproject/build-java.xml
	sync_file $ALOC/build-xcode.xml demo/android/$i/nbproject/build-xcode.xml
	sync_file $ALOC/build-android.xml demo/android/$i/nbproject/build-android.xml
	sync_file $ALOC/xmlvm.xml demo/android/$i/nbproject/xmlvm.xml

	sync_proj_prop $ALOC/project.properties demo/android/$i/nbproject/project.properties
	sync_build_impl $ALOC/build-impl.xml demo/android/$i/nbproject/build-impl.xml

	rm -f $ILOC/nbproject/xcode.xml 
	rm -f $ILOC/nbproject/androidsupport.xml 

	sync_build_file demo/android/afireworks/build.xml demo/android/$i/build.xml
done

